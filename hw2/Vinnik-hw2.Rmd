---
title: "22M04Vinnik-hw2"
author: "Vinnik Ekaterina"
date: "2024-03-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# ДЗ 2. Анализ данных стоимости медобслуживания пациентов (Medical Cost Personal Datasets)

## Винник Екатерина Петровна, 22.М04

```{r data}
library(readr)
options(readr.show_col_types = FALSE)
insurance_data <- read_csv("data/insurance.csv")
print(insurance_data)
```
## Построение гистограмм частот непрерывных признаков


В датасете имеются следующие непрерывные признаки:
  
- возраст (age)
- индекс массы тела (bmi)
- количество детей (children)
- расходы (charges)

Построим гистограмммы частот для всех этих признаков:
```{r}
library(ggplot2)
library(dplyr)
library(tidyr)

insurance_data %>% select_if(is.numeric) %>% pivot_longer(1:4, values_to="value", names_to="names") %>% ggplot() + geom_histogram(aes(x = value), bins = 20, colour = "black", fill = "white") + facet_wrap(~ names, scales = "free", ncol=2)
```


На гистограммах выше можно отметить, что среди множеств значений ``bmi`` и ``charges`` есть три наблюдения, которые имеют значения, большие, чем основная масса наблюдений.

```{r}
insurance_data %>% select(bmi, charges)  %>% tidyr::pivot_longer(1:2, values_to="value", names_to="names") %>% 
  ggplot() + geom_histogram(aes(x = value), bins = 100, colour = "black", fill = "white") + facet_wrap(~ names, scales = "free", ncol=2)
```

Найдем номера этих наблюдений:
```{r}
which(insurance_data$charges > 59000)
which(insurance_data$bmi > 50)
```
Таким образом, для признака `charges` это номера  544, 1231, 1301, а для признака `bmi` это номера 848, 1048, 1318.
При построении модели машинного обучения может быть осмысленно счесть эти значения выбросами.


## Сравнение выраженности непрерывных признаков между группами мужчин и женщин

Сравним, насколько выражены непрерывные признаки среди группы мужчин по сравнению с группой женщин. Для сравнения воспользуемся статистическим критерием. Будем использовать t-критерий Стьюдента, так как признаки, измеренные в выборке, являются непрерывными, а ключевая переменная пол (т.е. главная переменная для решения поставленной задачи) --- качественной.

### Индекс массы тела (bmi)
```{r}
ggplot(aes(x=bmi, fill = sex), data=insurance_data) + 
  geom_boxplot() + 
  labs(x = "bmi",title="Зависимость показателя индекса массы тела от пола") + 
  theme_bw()
```

**Нулевая гипотеза**: среднее значение индекса массы тела не отличается для групп мужчин и женщин.
```{r}
t.test(insurance_data$bmi ~ insurance_data$sex, paired=FALSE)
```
Так как p-значение (0.09) больше выбранного уровня значимости (0.05), нулевая гипотеза принимается. Таким образом, различия между рассматриваемыми группами мужчин и женщин по показателю индекс массы тела не являются значимыми.

### Возраст (age)

```{r}
ggplot(aes(x=age, fill = sex), data=insurance_data) + 
  geom_boxplot() + 
  labs(x = "age",title="Зависимость показателя возраста от пола") + 
  theme_bw()
```

**Нулевая гипотеза**: среднее значение возраста не различается для групп мужчин и женщин.
```{r}
t.test(insurance_data$age ~ insurance_data$sex, paired=FALSE)
```
Так как p-значение (0.45) больше выбранного уровня значимости (0.05), нулевая гипотеза принимается. Таким образом, различия между рассматриваемыми группами мужчин и женщин по показателю возраст не являются значимыми.

### Количество детей (children)

```{r}
ggplot(aes(x=children, fill = sex), data=insurance_data) + 
  geom_boxplot() + 
  labs(x = "charges",title="Зависимость показателя количества детей от пола") + 
  theme_bw()
```

**Нулевая гипотеза**: среднее значение количества детей не отличается для групп мужчин и женщин.

```{r}
t.test(insurance_data$children ~ insurance_data$sex, paired=FALSE)
```

Так как p-значение (0.53) больше выбранного уровня значимости (0.05), нулевая гипотеза принимается. Таким образом, различия между рассматриваемыми группами мужчин и женщин по показателю количество детей не являются значимыми.

### Расходы (charges)

```{r}
ggplot(aes(x=charges, fill = sex), data=insurance_data) + 
  geom_boxplot() + 
  labs(x = "charges",title="Зависимость показателя расходов от пола") + 
  theme_bw()
```

**Нулевая гипотеза**: среднее значение расходов не отличается для групп мужчин и женщин.
```{r}
t.test(insurance_data$charges ~ insurance_data$sex, paired=FALSE)
```
Так как p-значение (0.04) меньше выбранного уровня значимости (0.05), нулевая гипотеза отвергается. Таким образом, различия между рассматриваемыми группами мужчин и женщин по показателю расходы являются значимыми.

### Выводы

Таким образом, можно сказать, что:

- различия между мужчинами и женщинами по непрерывному признаку расходы (charges) являются значимыми
- различия по остальным признакам: возраст (age), количество детей (children), индекс массы тела (bmi) не являются значимыми

## Анализ коррелляций непрерывных признаков

```{r}
library(corrplot)
insurance_data <- insurance_data %>% mutate(children = as.numeric(children))
insurance_data
```
Посмотрим на корреляции признаков.
```{r}
plotCor <- corrplot(cor(insurance_data %>% select_if(is.numeric)))
```

Из матрицы корреляций видно, что:

- признаки age и charges коррелируют;
- также коррелируют и признаки bmi и charges;
- остальные пары признаков коррелируют в меньшей степени;
- совсем не коррелируют признаки children и bmi -- их корреляция равна 0 (что кажется логичным, так как индекс массы тела не зависит от количества детей).

Используем статистический вывод для установления зависимости коррелирующих переменных. Положим уровень значимости равным 0.05.

#### Корреляция переменных age и charges

**Нулевая гипотеза**: коэффициент корреляции между переменными ```age``` и ```charges``` равен нулю.

```{r}
cor.test(insurance_data$age, insurance_data$charges)
```
Статистика критерия равна 11.45 (1336 степеней свободы), p-value < 0.05. Таким образом, гипотеза о равенстве нулю коэффициента корреляции не принимается на выбранном уровне значимости.

#### Корреляция переменных bmi и charges

**Нулевая гипотеза**: коэффициент корреляции между переменными ```bmi``` и ```charges``` равен нулю.

```{r}
cor.test(insurance_data$bmi, insurance_data$charges)
```

Статистика критерия равна 7.39 (1336 степеней свободы), p-value < 0.05. Таким образом, гипотеза о равенстве нулю коэффициента корреляции не принимается на выбранном уровне значимости.

#### Корреляция переменных age и children

**Нулевая гипотеза**: коэффициент корреляции между переменными ```age``` и ```children``` равен нулю.

```{r}
cor.test(insurance_data$age, insurance_data$children)
```

Статистика критерия равна 1.55 (1336 степеней свободы), p-value > 0.05. Таким образом, гипотеза о равенстве нулю коэффициента корреляции не отвергается на выбранном уровне значимости. Это согласуется со значением корреляции для пары этих признаков, близким к нулю, на графике.

#### Корреляция переменных bmi и children

**Нулевая гипотеза**: коэффициент корреляции между переменными ```bmi``` и ```children``` равен нулю.

```{r}
cor.test(insurance_data$bmi, insurance_data$children)
```

Статистика критерия равна 0.46 (1336 степеней свободы), p-value > 0.05. Таким образом, гипотеза о равенстве нулю коэффициента корреляции не отвергается на выбранном уровне значимости. Это согласуется со значением корреляции для пары этих признаков, близким к нулю, на графике.

#### Корреляция переменных age и bmi

**Нулевая гипотеза**: коэффициент корреляции между переменными ```age``` и ```bmi``` равен нулю.

```{r}
cor.test(insurance_data$age, insurance_data$bmi)
```

Статистика критерия равна 4.02 (1336 степеней свободы), p-value < 0.05. Таким образом, гипотеза о равенстве нулю коэффициента корреляции не принимается на выбранном уровне значимости.

#### Корреляция переменных charges и children

**Нулевая гипотеза**: коэффициент корреляции между переменными ```children``` и ```charges``` равен нулю.

```{r}
cor.test(insurance_data$children, insurance_data$charges)
```

Статистика критерия равна 2.49 (1336 степеней свободы), p-value < 0.05. Таким образом, гипотеза о равенстве нулю коэффициента корреляции не принимается на выбранном уровне значимости.


